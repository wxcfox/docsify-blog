## MySQL

### 1. 介绍一下索引

索引介绍：

索引是一种用于快速检索数据的数据结构，本质是通过预排序+树形结构来加快检索。

索引类型：

按照数据结构维度划分:
```
B树，B+树和Hash、红黑树。MySQL中的Innodb和MyIsam，都使用了B+树作为索引结构。
```
按照底层存储方式角度划分：
```
聚簇索引（聚集索引）：索引结构和数据一起存放的索引，InnoDB 中的主键索引就属于聚簇索引。
非聚簇索引（非聚集索引）：索引结构和数据分开存放的索引，二级索引(辅助索引)就属于非聚簇索引。MySQL 的 MyISAM 引擎，不管主键还是非主键，使用的都是非聚簇索引。
```
按照应用维度划分：
```
主键索引：加速查询 + 列值唯一（不可以有 NULL）+ 表中只有一个。
普通索引：仅加速查询。
唯一索引：加速查询 + 列值唯一（可以有 NULL）。
覆盖索引：一个索引包含（或者说覆盖）所有需要查询的字段的值。
联合索引：多列值组成一个索引，专门用于组合搜索，其效率大于索引合并。
全文索引：对文本的内容进行分词，进行搜索。目前只有 CHAR、VARCHAR ，TEXT列上可以创建全文索引。一般不会使用，效率较低，通常使用搜索引擎如 ElasticSearch 代替。
```

索引的优缺点

**优点（速度和唯一性）：**

使用索引可以大大加快数据的检索速度（大大减少检索的数据量）,这也是创建索引的最主要的原因。

通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。

**缺点（时间和空间）：**

创建索引和维护索引需要耗费许多时间。当对表中的数据进行增删改的时候，如果数据有索引，那么索引也需要动态的修改，会降低 SQL 执行效率。

索引需要使用物理文件存储，也会耗费一定空间。

### 2. B树、B+树

B树和B+树都是平衡多路查找树，都是在二叉树的基础上改进的数据结构。二叉树上查找数据，最坏的情况是查找次数为树的深度，数据量很大时，查询次数很大，造成大量磁盘io，影响查询效率。为了减少磁盘io的次数，必须降低树的深度，所以在二叉树的基础上将树改成了多叉并加上一些限制条件，就形成了B树，B+树是B树的变种。

**B树、B+树区别：**

B树中所有节点都存放数据，B+树只有叶子节点存放数据

B树中的叶子节点是独立的，B+树的叶子节点通过链与相邻叶子节点连接。

B树查找使用二分查找，没有查找到叶子节点就可能结束，B+树必须从根节点进行查找，查询效率更稳定。

### 3. 索引怎么实现的B+树，为什么选这个数据结构

索引本质上是通过预排序+树形结构来加快检索效率，Mysql中使用InnoDB和MyISAM引擎时都使用B+树来实现索引。

B+树是一颗平衡多路查找树，是在二叉树的基础上改进的数据结构。二叉树查找数据时，最坏情况下查找次数为树的深度，当数据量很大时，会发生大量磁盘io，影响查询效率。为了减少磁盘io，就在二叉树的基础上改成了多叉并且加了限制条件形成B树，B+树又属于B树的变种。在B+树上，数据集合仅保留在叶子节点上，叶子节点间是个链的结构，从而可以支持快速范围查询，B+树上所有记录节点都是按照键值的大小顺序存放在同一层的叶子节点上，由各叶子节点指针进行链接。数据库中的B+树一般限制高度在2～4层，故io次数能稳定在2～4次。

数据库中的索引分为聚簇索引和非聚簇索引，聚簇索引一般用主键充当，叶子节点保存的是完整的一行记录，非聚簇索引保存的是非聚簇索引和其记录对应的聚簇索引，当通过非聚簇索引查找到相应数据的时候，最终还是需要通过叶子节点的聚簇索引拿到完整数据。
